<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="lang-select">
    <button id="lang-ro">RO</button>
    <button id="lang-eng">ENG</button>
</div>
<div id="main-menu">
    <button id="btn-story">Story Mode</button>
    <button id="btn-endless">Endless Run</button>
    <button id="btn-leaderboard">Leaderboard</button>
</div>
<div id="sound-toggle" title="Sound On/Off">
    <svg id="sound-svg" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g id="note-group">
            <path d="M12 18H20L28 10V38L20 30H12V18Z" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <path id="mute-line" d="M10 10L38 38" stroke="#ff4444" stroke-width="4" stroke-linecap="round"/>
        </g>
    </svg>
</div>
<audio id="menu-music" src="assets/music/main_theme.mp3" loop></audio>
<canvas id="canvas" style="display:none;"></canvas>
<script type="module">
    import { Main } from './src/systems/main.js';
    import { loadTranslations, t } from './src/i18n/i18n.js';
    const menu = document.getElementById('main-menu');
    const canvas = document.getElementById('canvas');
    const music = document.getElementById('menu-music');
    const soundToggle = document.getElementById('sound-toggle');
    const muteLine = document.getElementById('mute-line');
    const langSelect = document.getElementById('lang-select');
    const btnRO = document.getElementById('lang-ro');
    const btnENG = document.getElementById('lang-eng');
    let soundOn = false;

    function playMenuMusic() {
        if (music.paused) {
            music.volume = 0.5;
            music.play().catch(() => {});
        }
    }

    function updateSoundIcon() {
        muteLine.style.display = soundOn ? 'none' : 'block';
    }

    soundToggle.onclick = () => {
        if (!soundOn) {
            music.volume = 0.5;
            music.currentTime = 0;
            music.play().catch(() => {});
            soundOn = true;
        } else {
            music.pause();
            soundOn = false;
        }
        updateSoundIcon();
    };

    async function setLanguage(lang) {
        await loadTranslations(lang);
        document.getElementById('btn-story').textContent = t('continue');
        document.getElementById('btn-endless').textContent = 'Endless Run'; // Add to i18n if needed
        document.getElementById('btn-leaderboard').textContent = 'Leaderboard'; // Add to i18n if needed
        Main.setLang(lang);
    }

    btnRO.onclick = () => setLanguage('ro');
    btnENG.onclick = () => setLanguage('eng');

    updateSoundIcon();

    document.getElementById('btn-story').onclick = () => {
        menu.style.display = 'none';
        canvas.style.display = '';
        music.pause();
        music.currentTime = 0;
        const ctx = canvas.getContext('2d');
        ctx && ctx.clearRect(0, 0, canvas.width, canvas.height);
        const nextBtn = document.getElementById('next-level-btn');
        if (nextBtn) nextBtn.remove();
        Main.start(1, Main._lang);
    };
    document.getElementById('btn-endless').onclick = playMenuMusic;
    document.getElementById('btn-leaderboard').onclick = playMenuMusic;

    window.addEventListener('DOMContentLoaded', async () => {
        await setLanguage('ro');
        playMenuMusic();
    });
</script>
</body>
</html>